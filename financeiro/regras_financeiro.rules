<?xml version="1.0" encoding="UTF-8"?>
<ruleset name="Financeiro">
  
  <!-- 1Ô∏è‚É£ Tentativas consecutivas de login falho -->
  <rule id="FIN-001" level="7">
    <description>Tentativas de login falhas consecutivas detectadas</description>
    <condition>
      event.action == "failed-login" AND count(event.src_ip) &gt;= 5 AND within(60)
    </condition>
    <action>alert</action>
    <message>Poss√≠vel ataque de for√ßa bruta em portal financeiro</message>
  </rule>

  <!-- 2Ô∏è‚É£ Acesso a diret√≥rios administrativos -->
  <rule id="FIN-002" level="6">
    <description>Acesso ao diret√≥rio administrativo detectado</description>
    <condition>
      event.http.uri contains "/admin" AND event.http.status == 200
    </condition>
    <action>log</action>
    <message>Acesso administrativo detectado em aplica√ß√£o financeira</message>
  </rule>

  <!-- 3Ô∏è‚É£ Exfiltra√ß√£o de dados (volume de tr√°fego elevado) -->
  <rule id="FIN-003" level="9">
    <description>Volume de tr√°fego de sa√≠da anormal detectado</description>
    <condition>
      network.bytes_out &gt; 10000000 AND NOT event.user in ["backup","replicacao"]
    </condition>
    <action>alert</action>
    <message>Poss√≠vel exfiltra√ß√£o de dados detectada</message>
  </rule>

  <!-- 4Ô∏è‚É£ Download de arquivos execut√°veis -->
  <rule id="FIN-004" level="6">
    <description>Download de arquivo execut√°vel via HTTP</description>
    <condition>
      event.http.method == "GET" AND event.url endswith ".exe"
    </condition>
    <action>alert</action>
    <message>Download de execut√°vel identificado - poss√≠vel phishing</message>
  </rule>

  <!-- 5Ô∏è‚É£ Conex√£o SSH para IP externo -->
  <rule id="FIN-005" level="9">
    <description>Conex√£o SSH externa detectada</description>
    <condition>
      network.dst_port == 22 AND NOT network.dst_ip in CIDR("10.0.0.0/8","172.16.0.0/12","192.168.0.0/16")
    </condition>
    <action>block</action>
    <message>Conex√£o SSH suspeita com IP externo detectada</message>
  </rule>

  <!-- 6Ô∏è‚É£ Acesso a arquivos com dados sens√≠veis -->
  <rule id="FIN-006" level="10">
    <description>Acesso a arquivos de dados de clientes</description>
    <condition>
      event.file.name matches /card|cpf|dados_clientes/i
    </condition>
    <action>alert</action>
    <message>Acesso a arquivos contendo dados sens√≠veis detectado</message>
  </rule>

  <!-- 7Ô∏è‚É£ Consultas DNS para dom√≠nios maliciosos -->
  <rule id="FIN-007" level="10">
    <description>Consulta DNS para dom√≠nio classificado como malicioso</description>
    <condition>
      event.dns.query in threatintel.domains
    </condition>
    <action>block</action>
    <message>Conex√£o DNS suspeita identificada</message>
  </rule>

  <!-- 8Ô∏è‚É£ Cria√ß√£o de usu√°rio administrativo fora do hor√°rio comercial -->
  <rule id="FIN-008" level="7">
    <description>Cria√ß√£o de usu√°rio administrativo fora do hor√°rio normal</description>
    <condition>
      event.action == "user-create" AND event.user.role == "admin" AND NOT event.timestamp between "08:00".."18:00"
    </condition>
    <action>log</action>
    <message>Usu√°rio administrativo criado fora do hor√°rio comercial</message>
  </rule>

  <!-- 9Ô∏è‚É£ Altera√ß√£o n√£o autorizada de regras de firewall -->
  <rule id="FIN-009" level="8">
    <description>Modifica√ß√£o n√£o autorizada em pol√≠tica de firewall</description>
    <condition>
      event.source == "firewall" AND event.action == "rule-change" AND NOT event.user in ["admin-fw","soc"]
    </condition>
    <action>alert</action>
    <message>Mudan√ßa de regra de firewall detectada sem autoriza√ß√£o</message>
  </rule>

  <!-- üîü Sess√µes RDP iniciadas por IP externo -->
  <rule id="FIN-010" level="9">
    <description>Sess√£o RDP iniciada fora da rede corporativa</description>
    <condition>
      event.protocol == "RDP" AND NOT network.src_ip in CIDR("10.0.0.0/8","172.16.0.0/12","192.168.0.0/16")
    </condition>
    <action>alert</action>
    <message>Sess√£o RDP externa detectada - poss√≠vel invas√£o</message>
  </rule>

</ruleset>
